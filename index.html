<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FalakZoom</title>
    </link>
    href="https://fonts.googleapis.com/css2?
family=Poppins:wqht@300;400;600&display=swap"
    rel="stylesheet"
    />
    </link>
    href="https://fonts.googleapis.com/css2?
family=Cairo:wqht@400;600&display=swap"
    rel="stylesheet"
    />
    <style>
    body {
    margin: 0;
    overflow: hidden;
    background: black;
    font-family: "Poppins", "Cairo", Arial, sans-serif; /* Added Cairo */
}

#infoPanel {
    position: absolute;
    top: 70px;
    left: 20px;
    background: rgba(0, 0, 0, 0.88); /* Slightly more opaque */
    color: white;
    padding: 20px;
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.4);
    display: none;
    max-width: 400px; /* Slightly wider for more content */
    max-height: calc(100vh - 90px); /* Max height */
    overflow-y: auto; /* Allow scrolling if content exceeds height */
    font-size: 14px;
    line-height: 1.7;
    z-index: 50;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
    scrollbar-width: thin; /* Firefox */
    scrollbar-color: rgba(255, 255, 255, 0.3) rgba(0, 0, 0, 0.5); /* Firefox */
}

/* Webkit scrollbar styles */
#infoPanel::-webkit-scrollbar {
    width: 8px;
}
#infoPanel::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.5);
    border-radius: 10px; } #infoPanel::webkit-scrollbar-thumb { background-color: rgba(255, 255, 255, 0.3); border-radius: 10px; border: 2px solid rgba(0, 0, 0, 0.5); } #infoPanel h2 { margin-top: 0; margin-bottom: 15px; font-size: 18px; font-weight: 600; border-bottom: 1px solid rgba(255, 255, 255, 0.3); padding-bottom: 8px; } #infoPanel p { margin-bottom: 10px; } #infoPanel .fact { font-style: italic; color: #cccccc; margin-top: 15px; padding-top: 10px; border-top: 1px dashed rgba(255, 255, 255, 0.2); } /* Read More Button Styles */ #readMoreBtn { background-color: rgba(255, 255, 255, 0.15); color: #e0e0e0; border: 1px solid rgba(255, 255, 255, 0.3); padding: 8px 15px; border-radius: 5px; cursor: pointer; font-family: inherit; font-size: 13px; margin-top: 15px; transition: background-color 0.3s, color 0.3s; display: block; /* Make it block to take full width if needed */ width: fit-content; /* Adjust width to content */ } #readMoreBtn:hover { background-color: rgba(255, 255, 255, 0.25); color: white; }

/* Extra Facts Container Styles */
#extraFactsContainer {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid rgba(255, 255, 255, 0.3);
}

#extraFactsContainer p {
    font-size: 13px; /* Slightly smaller */
    color: #bbbbbb; /* Slightly dimmer */
    margin-bottom: 8px;
    padding-left: 10px; /* Indent facts */
    position: relative;
}

/* Add bullet points visually */
#extraFactsContainer p::before {
    content: '-';
    position: absolute;
    left: -2px; /* Adjust position based on language direction */
    top: 0;
    color: #66ccff; /* Accent color */
}

/* Adjust bullet for RTL */
[dir="rtl"] #extraFactsContainer p {
    padding-left: 0;
    padding-right: 10px;
}

[dir="rtl"] #extraFactsContainer p::before {
    left: auto;
    right: -2px;
}

#closeBtn {
    position: absolute;
    top: 10px;
    right: 10px; /* Default to right */
    width: 28px;
    height: 28px;
    font-size: 16px;
    font-weight: bold;
    color: #ff6b6b;
    cursor: pointer;
    transition: transform 0.3s ease, color 0.3s ease,
    background 0.3s ease;
    padding: 0;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 51; /* Ensure it's above content */
}

#closeBtn:hover {
    color: #f14757;
    transform: scale(1.1) rotate(90deg);
    background: rgba(255, 255, 255, 0.2);
}

#menuBar {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 50px;
    background: rgba(0, 0, 0, 0.8);
    padding: 0 20px;
    box-sizing: border-box;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 100;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}

.menu-controls {
    display: flex;
    align-items: center;
}

/* Updated style for all menu buttons to have consistent size */
.menu-item, #langToggleBtn, .speed-control-btn {
    position: relative;
    color: white;
    padding: 8px 15px;
    margin-left: 10px;
    cursor: pointer;
    font-family: "Poppins", "Cairo", sans-serif;
    border-radius: 4px;
    transition: background 0.3s ease, color 0.3s ease, border 0.3s ease;
    font-size: 14px;
    user-select: none;
    border: 1px solid transparent;
    background: rgba(255, 255, 255, 0.1);
    min-width: 80px; /* Added for consistent width */
    text-align: center; /* Center text */
    box-sizing: border-box; /* Include padding in width */
    height: 36px; /* Consistent height */
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Hover state for all buttons */
.menu-item:hover, #langToggleBtn:hover, .speed-control-btn:hover {
    background: rgba(255, 255, 255, 0.25);
    color: #eee;
}

/* Style for the active speed button */
.speed-control-btn.active {
    background: rgba(255, 255, 255, 0.3);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.4);
}

/* Container for speed controls */
#speedControls {
    display: flex;
    align-items: center;
    margin-left: 15px;
    padding-left: 15px;
    position: relative;
}

/* Separator lines between menu sections */
.menu-separator {
    width: 1px;
    height: 24px;
    background-color: rgba(255, 255, 255, 0.2);
    margin: 0 10px;
}

/* Speed value display */
.speed-value {
    margin: 0 10px;
    font-size: 14px;
    color: white;
    min-width: 20px;
    text-align: center;
}

/* Speed control buttons */
.speed-btn {
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.1);
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    transition: background 0.3s ease;
}

.speed-btn:hover {
    background: rgba(255, 255, 255, 0.25);
}

/* Dropdown styling */
.dropdown {
    position: absolute;
    top: 100%;
    right: 0; /* Default for LTR */
    background: rgba(25, 25, 25, 0.95);
    min-width: 180px;
    border-radius: 6px;
    overflow: hidden;
    display: none;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.1);
    z-index: 110;
}

/* RTL specific dropdown positioning */
body[dir="rtl"] .dropdown {
    right: auto; /* Reset LTR positioning */
    left: 0; /* Align to the left edge of the parent menu item */
}

.dropdown.show {
    display: block;
}

.dropdown-item {
    padding: 12px 20px;
    color: #e0e0e0;
    text-decoration: none;
    display: block;
    transition: background 0.2s ease, color 0.2s ease;
    font-size: 14px;
    white-space: nowrap;
}

.dropdown-item:hover {
    background: rgba(255, 255, 255, 0.15);
    color: white;
}

#title {
    color: white;
    font-family: "Poppins", sans-serif;
    font-size: 22px;
    font-weight: 600;
}

/* Language Direction Adjustments */
body[dir="rtl"] #infoPanel {
    left: auto;
    right: 20px;
    text-align: right;
}

body[dir="ltr"] #infoPanel {
    left: 20px;
    right: auto;
    text-align: left;
}

body[dir="rtl"] #closeBtn {
    left: 10px;
    right: auto;
}

body[dir="ltr"] #closeBtn {
    left: auto;
    right: 10px;
}

body[dir="rtl"] #readMoreBtn {
    margin-right: auto; /* Align button left in RTL */
}

body[dir="ltr"] #readMoreBtn {
    margin-left: auto; /* Align button right in LTR */
}

/* RTL adjustments for menu controls */
body[dir="rtl"] .menu-item, body[dir="rtl"] #langToggleBtn, body[dir="rtl"] .speed-control-btn {
    margin-left: 0;
    margin-right: 10px;
}

body[dir="rtl"] #speedControls {
    margin-left: 0;
    margin-right: 15px;
    padding-left: 0;
    padding-right: 15px;
    border-left: none;
    border-right: 1px solid rgba(255, 255, 255, 0.2);
}

body[dir="rtl"] #speedControls .speed-btn.first-child {
    margin-right: 0;
}

/* Ensure language toggle button has consistent width */
#langToggleBtn {
    width: 80px;
}

</style>
</head>
<body dir="rtl">
<div id="menuBar">
    <div id="title">FalakZoom</div>
    <div class="menu-controls">
        <div class="menu-item" id="planetsMenu">
            <div class="dropdown" id="planetsDropdown"></div>
        </div>
        
        <div class="menu-separator"></div>
        
        <div id="speedControls">
            <button class="speed-btn" id="speedDecrease">-</button>
            <div class="speed-value" id="speedDisplay">1x</div>
            <button class="speed-btn" id="speedIncrease">+</button>
        </div>
        
        <div class="menu-separator"></div>
        
        <div id="langToggleBtn">English</div>
    </div>
</div>

<div id="infoPanel">
    <span id="closeBtn"></span>
    <h2 id="planetName"></h2>
    <p id="planetInfo"></p>
    <p id="planetFact" class="fact"></p>
    <button id="readMoreBtn"></button>
    <div id="extraFactsContainer" style="display: none;"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three/examples/js/controls/OrbitControls.js"></script>
<script>
// -- Language and UI Text --
let currentLanguage = 'ar';
let currentlyDisplayedPlanetId = null; // Track displayed planet ID

// -- Simulation Speed --
let simulationSpeedMultiplier = 1;

const uiText = {
    planetsMenu: { ar: "اكوكي" , en: "Planets" }, // Added Arabic text
    langToggle: { ar: "English" , en: "العربية" }, // Added Arabic text
    readMore: { ar: "أفريا" , en: "Read More" }, // Added Arabic text
    // Add speed related text if needed later (e.g., tooltips)
};

// -- Planet Data (Unchanged, using existing structure) --
const planetsData = [
{
    id: 0, name: { ar: "الشمس" , en: "Sun" },
    radius: 5, distance: 0, speed: 0, tilt: 0, rotation: 0.01, texture: "Sun.jpg",
    info: {
    ar: "مليون كم" 1.391 الفطر: الجامعة الجزيرة 10^30 × 1.989 الكتلة: مليار سنة4.6 الممر: نجمال
    تسلسل رئيسي من النوع GNة طيون درجة مفهوم15 البدء حرارة اللغة، "درجة"
    en: "Diameter: 1.391 million km\nMass: 1.989 × 10^30 kg\nAge: 4.6 billion years\nType: G-type main-sequence stat\nCore Temperature: 15 million °C",
    },
    fact: {
    ar: "من كتلة النظام الشمسي وهي المصدر الرئيسي للطاقة الحياة%99.86 تحتوي الشمس على
    على الأرض "
    en: "The Sun contains 99.86% of the Solar System's mass and is the primary source of energy for life on Earth."
    },
    extraFacts: [
    { ar: "وتحول الهيدروجين إلى هيليو في نوائها" ، "نول الشمس الطاقة من خلال الاندماج النوري"
    en: "The Sun generates energy through nuclear fusion, converting hydrogen into helium in its core."
    { ar: "ثانية للوصول إلى الأرض" ، "بستغرق ضوء الشمس حوالي 8 دقائق و 20 en: "Light from the Sun takes about 8 minutes and 20 seconds to reach Earth."
    { ar: "ما يسبب ظواهر مثل البقع الشمسية والتهميات" ، "تمتلك الشمس مجاًلاً مغناطيسياً قوًًّا"
    "." الشمسية en: "The Sun has a powerful magnetic field, which causes phenomena like sunspots and solar flares."
    }
    }
},
{
    id: 1, name: { ar: "عطارد", en: "Mercury" },
    radius: 0.5, distance: 10, speed: 0.0125, tilt: 0.034, rotation: 0.003, texture: 
    "mercury.jpg",
    info: {
    ar: "كم 4,879 :القطر\nكجم 10²³ × 3.3 :الكتلة\nيومًا 88 :املدار\nم°173- :السطح حرارة درجة 
    م°427 إلى\nجوي غالف يوجد ال يكاد",
    en: "Diameter: 4,879 km\nMass: 3.3 × 10²³ kg\nOrbit: 88 days\nSurface 
    Temp: -173°C to 427°C\nAlmost no atmosphere",
    },
    fact: {
    ar: "البطيء دورانه بسبب أرضيًا يومًا 176 حوالي يستمر عطارد على (سيديرالي) واحد شمسي يوم 
    السريع ومداره.",
    en: "One solar day on Mercury lasts about 176 Earth days due to its slow 
    rotation and fast orbit."
    },
    extraFacts: [
    { ar: "والليل النهار بني الحرارة درجات في تقلبات أكبر ولديه كوكب أصغر هو عطارد.", en: 
    "Mercury is the smallest planet and has the most extreme temperature fluctuations 
    between day and night." },
    { ar: "قطر نصف من ٪85 حوالي تشكل ،متناسب غير بشكل كبيرة حديدية نواة عطارد يمتلك 
    الكوكب.", en: "Mercury has a disproportionately large iron core, making up about 85% 
    of the planet's radius."},
    { ar: "بشكل املظللة القطبية الفوهات في املاء جليد عن الكشف تم ،الشمس من قربه من الرغم على 
    عطارد على دائم.", en: "Despite its proximity to the Sun, water ice has been detected in 
    permanently shadowed polar craters on Mercury." }
    ]
},
{
    id: 2, name: { ar: "الزهرة", en: "Venus" },
    radius: 0.8, distance: 15, speed: 0.004375, tilt: 177.4, rotation: 0.0004, texture: 
    "venus.jpg",
    info: {
    ar: "كم 12,104 :القطر\nكجم 10²⁴ × 4.87 :الكتلة\nيومًا 225 :املدار\n:السطح حرارة درجة 
    م°464\nالكربون أكسيد ثاني من كثيف جوي غالف",
    en: "Diameter: 12,104 km\nMass: 4.87 × 10²⁴ kg\nOrbit: 225 days\nSurface 
    Temp: 464°C\nThick CO2 atmosphere",
    },
    fact: {
    ar: "دوران) األخرى الكواكب بمعظم مقارنة للخلف ويدور سخونة األكثر الكوكب هو الزهرة 
    (تراجعي.",
    en: "Venus is the hottest planet and rotates backwards compared to most 
    other planets (retrograde rotation)."
    },
    extraFacts: [
    { ar: "األرض على املاء تحت متر 900 عمق على الضغط يعادل الزهرة سطح على الجوي الضغط.", 
    en: "The atmospheric pressure on Venus's surface is equivalent to the pressure 900 
    meters underwater on Earth." },
    { ar: "(أرضيًا يومًا 225) سنته من أطول (أرضيًا يومًا 243) الزهرة على اليوم.", en: "A day on 
    Venus (243 Earth days) is longer than its year (225 Earth days)." },
    { ar: "تتكون سحب الزهرة بشكل أساسي من قطرات حمض الكبريتيك", en: "Venus's clouds are primarily composed of sulfuric acid droplets." }
    ]
},
{
    id: 3, name: { ar: "الرض"، en: "Earth"},
    radius: 1, distance: 20, speed: 0.003125, tilt: 23.5, rotation: 0.05, texture: "earth.jpg",
    info: {
    ar: "كم 12,742 كجم؟" القطر: 10^4 × 5.97 :ذكائرًا يومًا 365.25 دجوة حرارة السطح: Nn: الدار: n: بسطح؟
    58 م إلى °88~n71 مغطاة بالياه بنسبة %",
    en: "Diameter: 12,742 km/nMass: 5.97 × 10^4 kg\nOrbit: 365.25 days\nSurface Temp: -88°C to 58°C\n71% covered by water",
    },
    fact: {
    ar: "األرض هي الكويف الوحيد المورف الذي يستضيف الحياة ويحتوي على ماه سائل على ..."
    en: "Earth is the only known planet to host life and have liquid water on its surface."
    },
    extraFacts: [
    { ar: "يجمعي المجال المناطيسي لألرض الكويف من الإشعاع الشمسي الضار والرياح الشمسية", en: "Earth's magnetic field protects the planet from harmful solar radiation and solar wind." },
    { ar: "تتكون األرض من صفائح تكتونية تتحرك باستمرار، مما يسبب الازلزل والبراكين وتكوين", en: "Earth is composed of tectonic plates that constantly move, causing earthquakes, volcanoes, and mountain formation." },
    { ar: "القمر، القمر الطبيعي الوحيد لألرض، يؤثر على الد والجزر ويثبت ميل محور األرض", en: "The Moon, Earth's only natural satellite, influences tides and stabilizes Earth's axial tilt." }
    ]
},
{
    id: 4, name: { ar: "الربيع"، en: "Mars"},
    radius: 0.7, distance: 25, speed: 0.0025, tilt: 25.2, rotation: 0.048, texture: "mars.jpg",
    info: {
    ar: "كم 6,792 كجم؟" القطر: 10^3 × 6.42 يومًا ذكائرًا يومًا 687 دجوة حرارة السطح: Nn: الدار: n: بسطح؟
    20 م إلى °153~n كانت أكسيد الكربون؟"، ف جوي رقيق من ثاني "غلاف", en: "Diameter: 6,792 km/nMass: 6.42 × 10^3 kg\nOrbit: 687 days\nSurface Temp: -153°C to 20°C\nThin CO2 atmosphere",
    },
    fact: {
    ar: "يقرف الربيع بالكويف الأحمر بسبب أكسيد الحديد (الصداً) على سطحه وبه أطول بركان وأكبر". وإبر في النظام الشمسي
    en: "Mars is known as the Red Planet due to iron oxide (rust) on its surface and has the tallest volcano and largest canyon in the Solar System."  
    },
    extraFacts: [  
    { ar: "المرين قمران صغيران، فوبوس ويدموس، يُعتقد أنهما كويكيات تم أسره", en: "Mars has two small moons, Phobos and Deimos, which are thought to be captured asteroids." },
    { ar: "السائل على سطح املرينة في املاضي، وقد لا يزال موجود", en: "Mars had liquid water on its surface in the past, and may still exist underground." },
    { ar: "بكمله أحياناً which can sometimes cover the entire planet." }
    ]
},
{
    id: 5, name: { ar: "املشتري", en: "Jupiter" },
    radius: 2.5, distance: 35, speed: 0.00125, tilt: 3.1, rotation: 0.1, texture: "Jupiter.jpg",
    info: {
    ar: "كم 139,820 :كجم البقار 10^27 × 1.898 :نكذابة 11.86 سدالة قمة الدارة: 1445 م}", 
    en: "Diameter: 139,820 km\nMass: 1.898 × 10^27 kg\nOrbit: 11.86 years\nCloud Top Temp: -145°C\nGas giant",
    },
    fact: {
    ar: "الشترى هو أكبر كويك ويتميز بالبقعة الحمراء العظيمة، وهي عاصفة عملاقة مستعرة منذ", قرون
    en: "Jupiter is the largest planet and features the Great Red Spot, a giant storm raging for centuries."
    },
    extraFacts: [  
    { ar: "معرة من مجال 20,000 مرة من مجال", en: "Jupiter's magnetic field is about 20,000 times stronger than Earth's." },
    { ar: "ساعات بقليل 10 ساعة فقط من 10 بيعود املشتري أسرع من أي كويك آخر، ويكمل دورة واحدة في أقل من", en: "Jupiter rotates faster than any other planet, completing one rotation in just under 10 hours." },
    { ar: "يمتلك املشتري نظام حلقات باهت والعديد من الأقمار، بما في ذلك أقمار غالبايو الأربعة", en: "Jupiter has a faint ring system and many moons, including the four large Galilean moons: lo, Europa, Ganymede, and Callisto." }
    ]
},
{
    id: 6, name: { ar: "أزحل", en: "Saturn" },
    radius: 2, distance: 45, speed: 0.0009375, tilt: 26.7, rotation: 0.09, texture: "saturn.jpg",
    info: {
    ar: "كم 116,460 :القطر\nكجم 10²⁶ × 5.68 :الكتلة\nسنة 29.46 :املدار\nقمة حرارة درجة 
    م°184- :(متوسط) السحب\nغازي عمالق",
    en: "Diameter: 116,460 km\nMass: 5.68 × 10²⁶ kg\nOrbit: 29.46 years\nCloud 
    Top Temp: -184°C\nGas giant",
    },
    fact: {
    ar: "الصخور وحطام الجليد جزيئات من الغالب في املكون ،املذهل حلقاته بنظام زحل يشتهر.",
    en: "Saturn is famous for its stunning ring system, made mostly of ice 
    particles and rock debris."
    },
    extraFacts: [
    { ar: "حوض في سيطفو أنه يعني مما ،املاء من كثافة أقل إنه كثافة؛ األقل الكوكب هو زحل 
    الكفاية فيه بما كبير استحمام!", en: "Saturn is the least dense planet; it's less dense than 
    water, meaning it would float in a large enough bathtub!" },
    { ar: "جوي بغالف يتمتع الذي الشمسي النظام في الوحيد القمر هو ،تيتان ،زحل أقمار أكبر 
    سطحه على (اإليثان/امليثان من) سائلة وبحيرات سميك.", en: "Saturn's largest moon, Titan, is the 
    only moon in the Solar System with a thick atmosphere and liquid lakes (of methane/
    ethane) on its surface." },
    { ar: "لزحل الشمالي القطب عند الشكل سداسية مستمرة كبيرة عاصفة توجد.", en: "A large, 
    persistent hexagonal-shaped storm exists at Saturn's north pole." }
    ]
},
{
    id: 7, name: { ar: "أورانوس", en: "Uranus" },
    radius: 1.5, distance: 55, speed: 0.0005, tilt: 97.8, rotation: 0.06, texture: "uranus.jpg",
    info: {
    ar: "كم 50,724 :القطر\nكجم 10²⁵ × 8.68 :الكتلة\nسنة 84 :املدار\nالسحب قمة حرارة درجة 
    م°224- :(األدنى)\nجليدي عمالق",
    en: "Diameter: 50,724 km\nMass: 8.68 × 10²⁵ kg\nOrbit: 84 years\nCloud Top 
    Temp: -224°C\nIce giant",
    },
    fact: {
    ar: "الكواكب بني فريدًا يجعله مما ،درجة 98 يقارب محوري بميل جانبه على أورانوس يدور.",
    en: "Uranus rotates on its side with an axial tilt of nearly 98 degrees, making 
    it unique among planets."
    },
    extraFacts: [
    { ar: "الشمس عن األبعد ليس أنه من الرغم على ،الشمسي النظام في كوكب أبرد هو أورانوس.", 
    en: "Uranus is the coldest planet in the Solar System, despite not being the farthest 
    from the Sun." },
    { ar: "تاريخ من مبكر وقت في األرض بحجم بجسم هائل اصطدام عن ناتج الشديد ميله أن يُعتقد 
    الشمسي النظام.", en: "Its extreme tilt is thought to be the result of a massive collision 
    with an Earth-sized object early in the Solar System's history." },
    { ar: "بكثير وأضعف أغمق أنه من الرغم على ،حلقات نظام أورانوس يمتلك ،زحل مثل.", en: "Like 
    Saturn, Uranus possesses a ring system, although it is much darker and fainter." }
    ]
},
{
    id: 8, name: { ar: "نيتون", en: "Neptune" },
    radius: 1.5, distance: 65, speed: 0.000375, tilt: 28.3, rotation: 0.07, texture: "neptune.jpg",
    info: {
    ar: "<49,244 : كجم\القطر": 10^2 × 1.02 : سنة\الآذار: 164.8 \الرقم\السحب (متوسط): 
    201- م: "عمالق جليدي\السحب (متوسط)",
    en: "Diameter: 49,244 km\nMass: 1.02 × 10^2 kg\nOrbit: 164.8 years\nCloud Top Temp: -201°C\nloc giant",
    },
    fact: {
    ar: "نيتون هو أبعد كوكب عن الشمس، ويشتهر بلونه الأزرق العميق وأسرع الرياح في النظام الشمسي",
    en: "Neptune is the farthest planet from the Sun, known for its deep blue color and the fastest winds in the Solar System."
    },
    extraFacts: [
    { ar: "تم اكتشاف نيتون رياضياً قبل ملاحظته مباشرة، بناءً على الاضطرابات في مدار أورانوس",
    en: "Neptune was discovered mathematically before being directly observed, based on perturbations in Uranus's orbit." },
    { ar: "كيلومتر في الساعة 1200 ميل" },
    { ar: "أكبر أقمار نيتون، ترايتون، بدور حول الكوكب في اتجاه تراجعي (عكس دوران نيتون) ومن أكثر من حزام كويبير", en: "Neptune's largest moon, Triton, orbits the planet in a retrograde direction (opposite to Neptune's rotation) and is likely a captured Kuiper Belt Object." }
    ]
}
];

// -- THREE.js Setup --
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75,window.innerWidth / window.innerHeight, 0.1, 2000);
camera.position.set(0, 50, 100);
const renderer = new THREE.WebGLRenderer({ antialias: true });

renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.maxDistance = 400; controls.minDistance = 10;
controls.enableDamping = true;
controls.dampingFactor = 0.05;
let focusedPlanetIndex = -1; let isFollowingPlanet = false; let followAnimationId = null;
controls.addEventListener("start", () => { isFollowingPlanet = false;
    focusedPlanetIndex = -1; if (followAnimationId)
    cancelAnimationFrame(followAnimationId); });
const sunLight = new THREE.PointLight(0xffffff, 1.5, 1500); scene.add(sunLight);
const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
scene.add(ambientLight);
const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 0.3);
hemiLight.position.set(0, 100, 0); scene.add(hemiLight);
const loader = new THREE.TextureLoader();
const starGeometry = new THREE.BufferGeometry(); const starCount = 7000;
const positions = new Float32Array(starCount * 3);
for (let i = 0; i < starCount; i++) { positions[i * 3] = (Math.random() - 0.5) * 2500;
positions[i * 3 + 1] = (Math.random() - 0.5) * 2500;
positions[i * 3 + 2] = (Math.random() - 0.5) * 2500;}
starGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
const starMaterial = new THREE.PointsMaterial( color: 0xffffff, size: 0.15 );
const stars = new THREE.Points(starGeometry, starMaterial); scene.add(stars);
const planetMeshes = [];
planetsData.forEach((planet) => {
    const geometry = new THREE.SphereGeometry(planet.radius, 64, 64);
    const material = new THREE.MeshStandardMaterial( color: 0xffffff, emissive:
    planet.id === 0 ? 0xffff00 : 0x000000, emissiveIntensity: planet.id === 0 ? 1.8 : 0, ));
    loader.load('textures/${planet.texture}', (texture) => { material.map = texture; if
    (planet.id === 0) { material.emissiveMap = texture; material.emissive = new
    THREE.Color(0xffffaa); material.emissiveIntensity = 1.2; } material.needsUpdate =
    true; }, undefined, (err) => console.error('Error loading texture: ${planet.texture}',
    err));
    const mesh = new THREE.Mesh(geometry, material); mesh.position.x =
    planet.distance; mesh.rotation.x = (planet.title * Math.PI) / 180; mesh.userData.id =
    planet.id; scene.add(mesh);
    if (planet.distance > 0) { const points = []; const segments = 128; for (let i = 0; i
    <= segments; i++) { const theta = (i / segments) * Math.PI * 2; points.push(new
    THREE.Vector3(Math.cos(tbeta) * planet.distance, 0, Math.sin(tbeta) *
    planet.distance)); } const orbitGeometry = new
    THREE.BufferGeometry().setFromPoints(points);
    const colorMap = { 1: 0xaaaaaa, 2: 0xfcc99, 3: 0x3399ff, 4: 0xff3333, 5:
    0xffaa33, 6: 0xfid477, 7: 0x66ccff, 8: 0x3366cc, };
    const orbitMaterial = new THREE.LineBasicMaterial(color: colorMap[planet.id]
    || 0xffffff, transparent: true, opacity: 0.4, ); const orbit = new
    THREE.Line(orbitGeometry, orbitMaterial);
    scene.add(orbit);
    if (planet.id === 6) { const ringTexture = loader.load("textures/saturn_ring.png");
    const innerRadius = planet.radius * 1.2; const outerRadius = planet.radius * 2.2;
    const ringGeometry = new THREE.RingGeometry(innerRadius, outerRadius, 64);
    var pos = ringGeometry.attributes.position; var v3 = new THREE.Vector3(); for
    (let i = 0; i < pos.count; i++){ v3.fromBufferAttribute(pos, i);
    ringGeometry.attributes.uv.setXY(i, v3.length() < innerRadius + 0.1 ? 0 : 1, 1);
    } const ringMaterial = new THREE.MeshBasicMaterial( map: ringTexture, color:
    0xffffff, side: THREE.DoubleSide, transparent: true, opacity: 0.8 );
    const rings = new THREE.Mesh(ringGeometry, ringMaterial); rings.rotation.x =
    Math.PI / 2; mesh.add(rings);
    }
    if (planet.id === 5) { const spotGeometry = new THREE.SphereGeometry(planet.radius * 0.2, 16, 16);
    const spotMaterial = new THREE.MeshBasicMaterial({ color: 0xbb5533, transparent: true, opacity: 0.8 }); const redSpot = new THREE.Mesh(spotGeometry, spotMaterial);
    redSpot.position.set(0, planet.radius * 0.5, planet.radius * 0.85); mesh.add(redSpot); }
    planetMeshes.push({ mesh, planetData: planet, angle: Math.random() * Math.PI * 2 });
});

const asteroidGeometry = new THREE.BufferGeometry(); const asteroidCount = 1500; const asteroidPos = new Float32Array(asteroidCount * 3);

const marsOrbit = planetsData.find(p => p.id === 4).distance; const jupiterOrbit = planetsData.find(p => p.id === 5).distance;

const beltInnerRadius = marsOrbit + 3; const beltOuterRadius = jupiterOrbit - 5; const beltWidth = beltOuterRadius - beltInnerRadius;

for (let i = 0; i < asteroidCount; i++) { const angle = Math.random() * Math.PI * 2;

const radius = beltInnerRadius + Math.random() * beltWidth; asteroidPos[i * 3] = Math.cos(angle) * radius;

asteroidPos[i * 3 + 1] = (Math.random() - 0.5) * 1.0; asteroidPos[i * 3 + 2] = Math.sin(angle) * radius;

} asteroidGeometry.setAttribute('position', new THREE.BufferAttribute(asteroidPos, 3)); const asteroidMaterial = new THREE.PointsMaterial({ color: 0xaaaaaa, size: 0.08 });

const asteroids = new THREE.Points(asteroidGeometry, asteroidMaterial); scene.add(asteroids);

const cometGeometry = new THREE.SphereGeometry(0.2, 16, 16);

const cometMaterial = new THREE.MeshBasicMaterial({ color: 0xaaddff }); const comet = new THREE.Mesh(cometGeometry, cometMaterial); scene.add(comet);

const tailPoints = [new THREE.Vector3(0, 0, 0), new THREE.Vector3(0, 0, -2)]; const tailGeometry = new THREE.BufferGeometry().setFromPoints(tailPoints);

const tailMaterial = new THREE.LineBasicMaterial({ color: 0xaaddff, transparent: true, opacity: 0.6, linewidth: 2 }); const tail = new THREE.Line(tailGeometry, tailMaterial);

comet.add(tail);

const dustGeometry = new THREE.BufferGeometry(); const dustCount = 1000; const dustPos = new Float32Array(dustCount * 3);

for (let i = 0; i < dustCount; i++) { dustPos[i * 3] = (Math.random() - 0.5) * 200;

dustPos[i * 3 + 1] = (Math.random() - 0.5) * 200;

dustPos[i * 3 + 2] = (Math.random() - 0.5) * 200; } dustGeometry.setAttribute('position', new THREE.BufferAttribute(dustPos, 3));

const dustMaterial = new THREE.PointsMaterial({ color: 0x777777, size: 0.05, transparent: true, opacity: 0.4, }); const dust = new THREE.Points(dustGeometry, dustMaterial);

scene.add(dust);

// --- DOM Elements ---
const infoPanel = document.getElementById("infoPanel");
const planetNameEl = document.getElementById("planetName");
const planetInfoEl = document.getElementById("planetInfo");
const planetFactEl = document.getElementById("planetFact");
const closeBtn = document.getElementById("closeBtn");
const planetsMenu = document.getElementById("planetsMenu");
const planetsDropdown = document.getElementById("planetsDropdown");
const langToggleBtn = document.getElementById("langToggleBtn");
const bodyEl = document.body;
const readMoreBtn = document.getElementById("readMoreBtn");
const extraFactsContainer = document.getElementById("extraFactsContainer");
const speedDecreaseBtn = document.getElementById("speedDecrease");
const speedIncreaseBtn = document.getElementById("speedIncrease");
const speedDisplay = document.getElementById("speedDisplay");

// --- Raycasting ---
const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();

// --- Event Listeners ---
window.addEventListener("click", (event) => {
    // Prevent clicks on menu/infopanel from triggering raycast
    if (event.target.closest("#menuBar") || event.target.closest("#infoPanel")) {
    return;
}

mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
raycaster.setFromCamera(mouse, camera);

const intersects = raycaster.intersectObjects(planetMeshes.map((p) =>
p.mesh));

if (intersects.length > 0) {
    const clickedPlanetMesh = intersects[0].object;
    const planetId = clickedPlanetMesh.userData.id;
    if (planetId !== undefined) {
    focusOnPlanet(planetId);
    }
    }
});

closeBtn.addEventListener("click", () => {
    infoPanel.style.display = "none";
    isFollowingPlanet = false; focusedPlanetIndex = -1;
    currentlyDisplayedPlanetId = null;
});

planetsMenu.addEventListener("click", (e) => {
    e.stopPropagation(); planetsDropdown.classList.toggle("show");
});

// Close dropdown if clicking outside
document.addEventListener("click", (e) => {
    if (!planetsMenu.contains(e.target)) {
    planetsDropdown.classList.remove('show');
    }
});

langToggleBtn.addEventListener("click", () => {
    currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
    updateLanguageUI();
});

readMoreBtn.addEventListener("click", () => {
    const planetId = parseInt(readMoreBtn.getAttribute('data-planet-id'));
    if (!sNaN(planetId)) return;
    const planetData = planetsData.find(p => p.id === planetId);
    if (planetData && planetData.extraFacts) {
    populateExtraFacts(planetData.extraFacts);
    extraFactsContainer.style.display = 'block';
    readMoreBtn.style.display = 'none';
    }
});

// Speed control event listeners
speedDecreaseBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    if (simulationSpeedMultiplier > 1) {
        simulationSpeedMultiplier /= 2;
        updateSpeedDisplay();
    }
});

speedIncreaseBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    if (simulationSpeedMultiplier < 16) {
        simulationSpeedMultiplier *= 2;
        updateSpeedDisplay();
    }
});

// --- Functions ---
function updateSpeedDisplay() {
    speedDisplay.textContent = simulationSpeedMultiplier + 'x';
}

function populateExtraFacts(facts) {
    extraFactsContainer.innerHTML = "";
    facts.forEach(fact => {
        const p = document.createElement('p');
        p.textContent = fact[currentLanguage];
        extraFactsContainer.appendChild(p);
    });
}

function displayPlanetInfo(planetData) {
    planetNameEl.textContent = planetData.name[currentLanguage];
    planetInfoEl.innerHTML = planetData.info[currentLanguage].replace(An/g, "<br>");
    planetFactEl.textContent = planetData.fact[currentLanguage];
    currentlyDisplayedPlanetId = planetData.id;

    // Reset and setup Read More section
    extraFactsContainer.style.display = 'none';
    extraFactsContainer.innerHTML = "";
    if (planetData.extraFacts && planetData.extraFacts.length > 0) {
        readMoreBtn.style.display = 'block';
        readMoreBtn.setAttribute('data-planet-id', planetData.id);
        readMoreBtn.textContent = uiText.readMore[currentLanguage];
    } else {
        readMoreBtn.style.display = 'none';
    }

    infoPanel.style.display = "block";
    infoPanel.scrollTop = 0;
}

function updateLanguageUI() {
    bodyEl.dir = currentLanguage === 'ar' ? 'rtl' : 'ltr';
    planetsMenu.firstChild.textContent = uiText.planetsMenu[currentLanguage].trim() || '';
    langToggleBtn.textContent = uiText.langToggle[currentLanguage];
    readMoreBtn.textContent = uiText.readMore[currentLanguage];

    // Update dropdown items
    planetsDropdown.innerHTML = "";
    planetsData.forEach((planet) => {
        const item = document.createElement("a");
        item.href = "#"; item.classList.add("dropdown-item");
        item.setAttribute("data-planet-id", planet.id);
        item.textContent = planet.name[currentLanguage];
        item.addEventListener("click", (e) => {
            e.preventDefault(); e.stopPropagation();
            const planetId = parseInt(item.getAttribute("data-planet-id"));
            focusOnPlanet(planetId);
            planetsDropdown.classList.remove("show");
        });
        planetsDropdown.appendChild(item);
    });

    // If info panel is open, update its content
    if (currentlyDisplayedPlanetId !== null) {
        const currentPlanetData = planetsData.find(p => p.id === currentlyDisplayedPlanetId);
        if (currentPlanetData) {
            planetNameEl.textContent = currentPlanetData.name[currentLanguage];
            planetInfoEl.innerHTML = currentPlanetData.info[currentLanguage].replace(An/g, "<br>");
            planetFactEl.textContent = currentPlanetData.fact[currentLanguage];
            readMoreBtn.setAttribute('data-planet-id', currentPlanetData.id);

            if (extraFactsContainer.style.display === 'block' && currentPlanetData.extraFacts) {
                populateExtraFacts(currentPlanetData.extraFacts);
            }
            if (extraFactsContainer.style.display !== 'block' && currentPlanetData.extraFacts && currentPlanetData.extraFacts.length > 0) {
                readMoreBtn.style.display = 'block';
            } else {
                readMoreBtn.style.display = 'none';
            }
        }
    }

    infoPanel.style.textAlign = currentLanguage === 'ar' ? 'right' : 'left';
}

function focusOnPlanet(planetId) {
    const planetIndex = planetsData.findIndex(p => p.id === planetId);
    if (planetIndex === -1) return;
    const targetPlanet = planetMeshes[planetIndex]; const targetData = targetPlanet.planetData;
    if (followAnimationId) cancelAnimationFrame(followAnimationId);
    focusedPlanetIndex = planetIndex;
    infoPanel.style.display = 'none'; currentlyDisplayedPlanetId = null;
    const startPosition = camera.position.clone();
    const startTarget = controls.target.clone();
    const endTarget = targetPlanet.mesh.position.clone();
    const offsetDistance = targetData.radius * (targetData.id === 0 ? 5 : 8);
    const direction = new THREE.Vector3(0, 0.2, 1);
    direction.applyQuaternion(targetPlanet.mesh.quaternion); direction.normalize();
    const endPosition = endTarget.clone().add(direction.multiplyScalar(offsetDistance));
    const duration = 1500;
    const startTime = Date.now();
    function animateCameraFocus() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const easeProgress = 0.5 * (1 - Math.cos(Math.PI * progress));
        camera.position.lerpVectors(startPosition, endPosition, easeProgress);
        controls.target.lerpVectors(startTarget, endTarget, easeProgress);
        controls.update();
        if (progress < 1) { followAnimationId = requestAnimationFrame(animateCameraFocus);
        }
        else { followAnimationId = null;
            isFollowingPlanet = true; controls.target.copy(endTarget);
            camera.position.copy(endPosition); controls.update();
            displayPlanetInfo(targetData); }
    }
    animateCameraFocus();
}

// --- Animation Loop ---
function animate() {
    requestAnimationFrame(animate);

    // Use speed multiplier
    const effectiveRotationSpeed = 0.1 * simulationSpeedMultiplier;
    const effectiveOrbitSpeed = 0.5 * simulationSpeedMultiplier;
    const effectiveCometSpeed = 0.0002 * simulationSpeedMultiplier;

    planetMeshes.forEach((p, index) => {
        const { mesh, planetData } = p;
        // Apply speed multiplier to rotation
        mesh.rotation.y += planetData.rotation * effectiveRotationSpeed;
        if (planetData.distance > 0) {
            // Apply speed multiplier to orbit speed
            p.angle += planetData.speed * effectiveOrbitSpeed;
            mesh.position.x = Math.cos(p.angle) * planetData.distance;
            mesh.position.z = Math.sin(p.angle) * planetData.distance;
        }
        // Following logic remains unchanged relative to planet position
        if (isFollowingPlanet && index === focusedPlanetIndex) {
            const currentTargetPosition = mesh.position.clone();
            controls.target.copy(currentTargetPosition);
            const offsetDistance = planetData.radius * (planetData.id === 0 ? 5 : 8);
            const direction = new THREE.Vector3(0, 0.2, 1);
            direction.applyQuaternion(mesh.quaternion);
            direction.normalize();
            const desiredPosition = currentTargetPosition.clone().add(direction.multiplyScalar(offsetDistance));
            // Camera lerp speed remains constant for smooth following, not affected by simulation speed
            camera.position.lerp(desiredPosition, 0.05);
        }
    });

    // Apply speed multiplier to comet
    const cometTime = Date.now() * effectiveCometSpeed;
    const cometSemiMajor = 80; const cometSemiMinor = 50;
    comet.position.x = Math.cos(cometTime) * cometSemiMajor;
    comet.position.z = Math.sin(cometTime) * cometSemiMinor;
    comet.position.y = Math.sin(cometTime * 0.7) * 15;
    const dirToSun = comet.position.clone().normalize().negate();
    comet.lookAt(comet.position.clone().add(dirToSun));

    controls.update(); // OrbitControls update
    renderer.render(scene, camera);
}

// --- Initial Setup ---
updateLanguageUI(); // Initialize UI text and dropdown
updateSpeedDisplay(); // Initialize speed display
animate(); // Start animation loop

// --- Resize Listener ---
window.addEventListener("resize", () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
