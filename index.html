[source: 265] <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FalakZoom</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      /* body style - transition removed */
      body {
        margin: 0;
[source: 266] overflow: hidden;
        background: black;
        font-family: "Poppins", "Cairo", Arial, sans-serif; /* Added Cairo */
      }

      #infoPanel {
        position: absolute;
[source: 267] top: 70px; /* Adjusted from 50px of menubar + 20px padding */
        left: 20px;
[source: 268] background: rgba(0, 0, 0, 0.88); /* Slightly more opaque */
        color: white;
[source: 269] padding: 20px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.4);
        display: none;
        max-width: 400px;
[source: 270] /* Slightly wider for more content */
        max-height: calc(100vh - 90px);
[source: 271] /* Max height (consider menubar height) */
        overflow-y: auto;
[source: 272] /* Allow scrolling if content exceeds height */
        font-size: 14px;
        line-height: 1.7;
[source: 273] z-index: 50;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        scrollbar-width: thin;
[source: 274] /* Firefox */
        scrollbar-color: rgba(255, 255, 255, 0.3) rgba(0, 0, 0, 0.5);
[source: 275] /* Firefox */
      }
       /* Webkit scrollbar styles */
      #infoPanel::-webkit-scrollbar {
        width: 8px;
[source: 276] }
      #infoPanel::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.5);
[source: 277] border-radius: 10px;
      }
       #infoPanel::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.3);
[source: 278] border-radius: 10px;
        border: 2px solid rgba(0, 0, 0, 0.5);
      }


      #infoPanel h2 {
          margin-top: 0;
[source: 279] margin-bottom: 15px;
          font-size: 18px;
          font-weight: 600;
          border-bottom: 1px solid rgba(255, 255, 255, 0.3);
          padding-bottom: 8px;
[source: 280] }

      #infoPanel p {
          margin-bottom: 10px;
[source: 281] }

       #infoPanel .fact {
           font-style: italic;
[source: 282] color: #cccccc;
           margin-top: 15px;
           padding-top: 10px;
           border-top: 1px dashed rgba(255, 255, 255, 0.2);
[source: 283] }

       /* Read More Button Styles */
       #readMoreBtn {
           background-color: rgba(255, 255, 255, 0.15);
[source: 284] color: #e0e0e0;
           border: 1px solid rgba(255, 255, 255, 0.3);
           padding: 8px 15px;
           border-radius: 5px;
           cursor: pointer;
           font-family: inherit;
           font-size: 13px;
[source: 285] margin-top: 15px;
           transition: background-color 0.3s, color 0.3s;
           display: block; /* Make it block to take full width if needed */
           width: fit-content;
[source: 286] /* Adjust width to content */
       }
        #readMoreBtn:hover {
            background-color: rgba(255, 255, 255, 0.25);
[source: 287] color: white;
        }

       /* Extra Facts Container Styles */
       #extraFactsContainer {
           margin-top: 15px;
[source: 288] padding-top: 15px;
           border-top: 1px solid rgba(255, 255, 255, 0.3);
       }
        #extraFactsContainer p {
            font-size: 13px;
[source: 289] /* Slightly smaller */
            color: #bbbbbb;
[source: 290] /* Slightly dimmer */
            margin-bottom: 8px;
            padding-left: 10px;
[source: 291] /* Indent facts */
            position: relative;
[source: 292] }
         /* Add bullet points visually */
         #extraFactsContainer p::before {
            content: '•';
[source: 293] position: absolute;
            left: -2px; /* Adjust position based on language direction */
            top: 0;
[source: 294] color: #66ccff; /* Accent color */
         }
          /* Adjust bullet for RTL */
          [dir="rtl"] #extraFactsContainer p {
            padding-left: 0;
[source: 295] padding-right: 10px;
          }
          [dir="rtl"] #extraFactsContainer p::before {
             left: auto;
[source: 296] right: -2px;
          }


      #closeBtn {
        position: absolute;
[source: 297] top: 10px;
        right: 10px; /* Default to right */
        width: 28px;
        height: 28px;
[source: 298] font-size: 16px;
        font-weight: bold;
        color: #ff6b6b;
        cursor: pointer;
        transition: transform 0.3s ease, color 0.3s ease,
          background 0.3s ease;
[source: 299] padding: 0;
        background: rgba(255, 255, 255, 0.1);
        border: none; /* Changed from specific border */
        border-radius: 50%;
[source: 300] display: flex;
        justify-content: center;
        align-items: center;
        z-index: 51; /* Ensure it's above content */
      }

      #closeBtn:hover {
        color: #ff4757;
[source: 301] transform: scale(1.1) rotate(90deg);
        background: rgba(255, 255, 255, 0.2);
      }

      #menuBar {
        position: absolute;
[source: 302] top: 0;
        left: 0;
        width: 100%;
        height: 50px;
        background: rgba(0, 0, 0, 0.85);
[source: 303] /* Slightly more opaque */
        padding: 0 20px;
        box-sizing: border-box;
        display: flex;
[source: 304] justify-content: space-between;
        align-items: center;
        z-index: 100;
        border-bottom: 1px solid rgba(255, 255, 255, 0.15);
[source: 305] /* Slightly softer border */
      }

       /* Container for right-side controls */
      .controls-right {
          display: flex;
[source: 306] align-items: center;
      }

      /* Style for individual controls in menu - Cleaner look */
      .menu-item, #langToggleBtn, .time-control-btn {
        position: relative;
[source: 307] color: white;
        padding: 8px 12px; /* Consistent padding */
        margin-left: 8px;
[source: 308] /* Slightly reduced space between items */
        cursor: pointer;
        font-family: "Poppins", "Cairo", sans-serif;
[source: 309] border-radius: 4px;
        transition: background 0.3s ease, color 0.3s ease;
        font-size: 14px;
        user-select: none;
        background-color: rgba(255, 255, 255, 0.08);
[source: 310] /* Slightly less visible background */
        border: none;
[source: 311] /* Removed individual borders */
        /* *** ADDED FOR CONSISTENT SIZE *** */
        min-width: 100px; /* Ensure a minimum width */
        text-align: center; /* Center text within the button */
      }
      .time-control-btn {
        /* Padding is now inherited from the rule above */
        margin-left: 4px;
[source: 312] /* Closer time controls */
         min-width: auto; /* Override min-width for smaller time buttons */
         padding: 8px; /* Adjust padding if needed for icons */
      }

      .menu-item:hover, #langToggleBtn:hover, .time-control-btn:hover {
        background: rgba(255, 255, 255, 0.2);
[source: 313] /* Keep hover distinct */
        color: #eee;
[source: 314] }

       /* Style for the speed display */
       #speedDisplay {
           color: #ccc;
[source: 315] font-size: 13px;
           margin-left: 8px; /* Match menu item spacing */
           padding: 8px 5px;
[source: 316] /* Adjusted padding */
           min-width: 40px;
[source: 317] /* Slightly reduced width */
           text-align: center;
           user-select: none;
[source: 318] }


      .dropdown {
        position: absolute;
        top: 100%;
[source: 319] /* Position below the menu item */
        right: 0;
[source: 320] /* Default LTR positioning */
        margin-top: 4px;
[source: 321] /* Add small gap */
        background: rgba(25, 25, 25, 0.95);
        min-width: 180px;
[source: 322] border-radius: 6px; /* Round all corners */
        overflow: hidden;
        display: none;
[source: 323] box-shadow: 0 8px 16px rgba(0, 0, 0, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.15);
[source: 324] /* Consistent border */
        z-index: 110;
[source: 325] }

      /* --- Added Rule for RTL Dropdown Positioning --- */
      body[dir="rtl"] .dropdown {
        right: auto;
[source: 326] /* Remove default right positioning */
        left: 0;
[source: 327] /* Position from the left in RTL */
      }

      .dropdown.show {
        display: block;
[source: 328] }

      .dropdown-item {
        padding: 12px 20px;
        color: #e0e0e0;
[source: 329] text-decoration: none;
        display: block;
        transition: background 0.2s ease, color 0.2s ease;
        font-size: 14px;
        white-space: nowrap;
[source: 330] }

      .dropdown-item:hover {
        background: rgba(255, 255, 255, 0.15);
[source: 331] color: white;
      }

      #title {
        color: white;
[source: 332] font-family: "Poppins", sans-serif;
        font-size: 22px;
        font-weight: 600;
      }

       /* Language Direction Adjustments */
       body[dir="rtl"] #infoPanel {
            left: auto;
[source: 333] right: 20px;
            text-align: right;
       }
       body[dir="ltr"] #infoPanel {
            left: 20px;
[source: 334] right: auto;
            text-align: left;
       }
       body[dir="rtl"] #closeBtn {
            left: 10px;
[source: 335] right: auto;
       }
       body[dir="ltr"] #closeBtn {
            left: auto;
[source: 336] right: 10px;
       }
        body[dir="rtl"] #readMoreBtn {
            margin-right: auto;
[source: 337] /* Align button left in RTL */
        }
        body[dir="ltr"] #readMoreBtn {
            margin-left: auto;
[source: 338] /* Align button right in LTR */
        }
        /* RTL adjustments for menu items */
        body[dir="rtl"] .menu-item, body[dir="rtl"] #langToggleBtn, body[dir="rtl"] .time-control-btn, body[dir="rtl"] #speedDisplay {
            margin-left: 0;
[source: 339] margin-right: 8px; /* Match adjusted spacing */
        }
         body[dir="rtl"] .time-control-btn {
            margin-right: 4px;
[source: 340] /* Match closer time controls */
         }
         body[dir="rtl"] #speedDisplay {
             margin-right: 8px;
[source: 341] /* Match menu item spacing */
         }

    </style>
  </head>
  <body dir="rtl"> <div id="menuBar">
      <div id="title">FalakZoom</div>
      <div class="controls-right">
         <button class="time-control-btn" id="slowDownBtn">⏪</button> <button class="time-control-btn" id="playPauseBtn">⏸️</button> <button class="time-control-btn" id="speedUpBtn">⏩</button> <span id="speedDisplay">1x</span>
        <div id="langToggleBtn">English</div>
        <div
[source: 342] class="menu-item" id="planetsMenu">
          Planets
          <div class="dropdown" id="planetsDropdown">
            </div>
        </div>
      </div>
    </div>

    <div id="infoPanel">
      <span id="closeBtn">X</span>
      <h2 id="planetName"></h2>
      <p id="planetInfo"></p>
      <p id="planetFact" class="fact"></p>
      <button id="readMoreBtn">Read More</button>
      <div id="extraFactsContainer" style="display: none;">
[source: 343] </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three/examples/js/controls/OrbitControls.js"></script>
    <script>
      // --- Language and UI Text ---
      let currentLanguage = 'ar';
[source: 344] let currentlyDisplayedPlanetId = null; // Track displayed planet ID

      const uiText = {
          planetsMenu: { ar: "الكواكب", en: "Planets" },
          langToggle: { ar: "English", en: "العربية" },
          readMore: { ar: "اقرأ المزيد", en: "Read More" },
          playBtn: { ar: "▶️", en: "▶️" }, // Using icons
          pauseBtn: { ar: "⏸️", en: "⏸️" } // Using icons
[source: 345] // Constellation text removed
      };
[source: 346] // --- Planet Data with Multilingual Support & Extra Facts ---
      const planetsData = [
         { id: 0, name: { ar: "الشمس", en: "Sun" }, radius: 5, distance: 0, speed: 0, tilt: 0, rotation: 0.01, texture: "sun.jpg", info: { ar: "القطر: 1.391 مليون كم\nالكتلة: 1.989 × 10³⁰ كجم\nالعمر: 4.6 مليار سنة\nالنوع: نجم قزم أصفر (G)\nدرجة حرارة اللب: 15 مليون درجة مئوية", en: "Diameter: 1.391 million km\nMass: 1.989 × 10³⁰ kg\nAge: 4.6 billion years\nType: G-type main-sequence star\nCore Temperature: 15 million °C" }, fact: { ar: "تحتوي الشمس على 99.86% من كتلة النظام الشمسي وهي المصدر الرئيسي للطاقة للحياة على الأرض.", en: "The Sun contains 99.86% of the Solar System's mass and is the primary source of energy for life on Earth."
[source: 347] }, extraFacts: [{ar:"تولد الشمس الطاقة من خلال الاندماج النووي، محولة الهيدروجين إلى هيليوم في لبها.", en:"The Sun generates energy through nuclear fusion, converting hydrogen into helium in its core."},{ar:"يستغرق ضوء الشمس حوالي 8 دقائق و 20 ثانية للوصول إلى الأرض.", en:"Light from the Sun takes about 8 minutes and 20 seconds to reach Earth."},{ar:"تمتلك الشمس مجالًا مغناطيسيًا قويًا، يتسبب في ظواهر مثل البقع الشمسية والتوهجات الشمسية.", en:"The Sun has a powerful magnetic field, which causes phenomena like sunspots and solar flares."}] },
         { id: 1, name: { ar: "عطارد", en: "Mercury" }, radius: 0.5,
[source: 348] distance: 10, speed: 0.0125, tilt: 0.034, rotation: 0.003, texture: "mercury.jpg", info: { ar: "القطر: 4,879 كم\nالكتلة: 3.3 × 10²³ كجم\nالدورة المدارية: 88 يومًا\nحرارة السطح: -173°م إلى 427°م\nلا يوجد غلاف جوي تقريبًا", en: "Diameter: 4,879 km\nMass: 3.3 × 10²³ kg\nOrbit: 88 days\nSurface Temp: -173°C to 427°C\nAlmost no atmosphere" }, fact: { ar: "يستمر اليوم الشمسي الواحد على عطارد (من شروق إلى شروق) حوالي 176 يومًا أرضيًا بسبب دورانه البطيء ومداره السريع.", en: "One solar day on Mercury lasts about 176 Earth days due to its slow rotation and fast orbit."
[source: 349] }, extraFacts: [{ar:"عطارد هو أصغر كوكب ولديه أكبر تقلبات في درجات الحرارة بين النهار والليل.", en:"Mercury is the smallest planet and has the most extreme temperature fluctuations between day and night."},{ar:"يمتلك عطارد نواة حديدية كبيرة بشكل غير متناسب، تشكل حوالي 85% من نصف قطر الكوكب.", en:"Mercury has a disproportionately large iron core, making up about 85% of the planet's radius."},{ar:"على الرغم من قربه من الشمس، تم اكتشاف جليد مائي في فوهات قطبية مظللة بشكل دائم على عطارد.", en:"Despite its proximity to the Sun, water ice has been detected in permanently shadowed polar craters on Mercury."}] },
         { id: 2, name: { ar: "الزهرة", en: "Venus" }, radius: 0.8, distance: 15, speed: 0.004375, tilt: 177.4, rotation: 0.0004, texture: "venus.jpg", info: { ar: "القطر: 12,104 كم\nالكتلة: 4.87 × 10²⁴ كجم\nالدورة المدارية: 225 يومًا\nحرارة السطح: 464°م\nغلاف جوي كثيف من ثاني أكسيد الكربون", en: "Diameter: 12,104 km\nMass: 4.87 × 10²⁴ kg\nOrbit: 225 days\nSurface Temp: 464°C\nThick CO2 atmosphere" }, fact: { ar: "الزهرة هو أسخن كوكب ويدور للخلف مقارنة بمعظم الكواكب الأخرى (دوران تراجعي).", en: "Venus is the hottest planet and rotates backwards compared to most other planets (retrograde rotation)."
[source: 350] }, extraFacts: [{ar:"الضغط الجوي على سطح الزهرة يعادل الضغط على عمق 900 متر تحت الماء على الأرض.", en:"The atmospheric pressure on Venus's surface is equivalent to the pressure 900 meters underwater on Earth."},{ar:"اليوم على الزهرة (243 يومًا أرضيًا) أطول من سنته (225 يومًا أرضيًا).", en:"A day on Venus (243 Earth days) is longer than its year (225 Earth days)."},{ar:"تتكون سحب الزهرة بشكل أساسي من قطرات حمض الكبريتيك.", en:"Venus's clouds are primarily composed of sulfuric acid droplets."}] },
         { id: 3, name: { ar: "الأرض", en: "Earth" }, radius: 1, distance: 20, speed:
[source: 351] 0.003125, tilt: 23.5, rotation: 0.05, texture: "earth.jpg", info: { ar: "القطر: 12,742 كم\nالكتلة: 5.97 × 10²⁴ كجم\nالدورة المدارية: 365.25 يومًا\nحرارة السطح: -88°م إلى 58°م\n71% مغطى بالماء", en: "Diameter: 12,742 km\nMass: 5.97 × 10²⁴ kg\nOrbit: 365.25 days\nSurface Temp: -88°C to 58°C\n71% covered by water" }, fact: { ar: "الأرض هي الكوكب الوحيد المعروف بوجود حياة ومياه سائلة على سطحه.", en: "Earth is the only known planet to host life and have liquid water on its surface."
[source: 352] }, extraFacts: [{ar:"يحمي المجال المغناطيسي للأرض الكوكب من الإشعاع الشمسي الضار والرياح الشمسية.", en:"Earth's magnetic field protects the planet from harmful solar radiation and solar wind."},{ar:"تتكون الأرض من صفائح تكتونية تتحرك باستمرار، مما يسبب الزلازل والبراكين وتكوين الجبال.", en:"Earth is composed of tectonic plates that constantly move, causing earthquakes, volcanoes, and mountain formation."},{ar:"القمر، التابع الطبيعي الوحيد للأرض، يؤثر على المد والجزر ويثبت ميل محور دوران الأرض.", en:"The Moon, Earth's only natural satellite, influences tides and stabilizes Earth's axial tilt."}] },
         { id: 4, name: { ar: "المريخ", en: "Mars" }, radius: 0.7,
[source: 353] distance: 25, speed: 0.0025, tilt: 25.2, rotation: 0.048, texture: "mars.jpg", info: { ar: "القطر: 6,792 كم\nالكتلة: 6.42 × 10²³ كجم\nالدورة المدارية: 687 يومًا\nحرارة السطح: -153°م إلى 20°م\nغلاف جوي رقيق من ثاني أكسيد الكربون", en: "Diameter: 6,792 km\nMass: 6.42 × 10²³ kg\nOrbit: 687 days\nSurface Temp: -153°C to 20°C\nThin CO2 atmosphere" }, fact: { ar: "يُعرف المريخ بالكوكب الأحمر بسبب أكسيد الحديد (الصدأ) على سطحه ويضم أطول بركان وأكبر وادٍ في النظام الشمسي.", en: "Mars is known as the Red Planet due to iron oxide (rust) on its surface and has the tallest volcano and largest canyon in the Solar System."
[source: 354] }, extraFacts: [{ar:"للمريخ قمران صغيران، فوبوس وديموس، يُعتقد أنهما كويكبات تم التقاطها.", en:"Mars has two small moons, Phobos and Deimos, which are thought to be captured asteroids."},{ar:"هناك أدلة قوية على وجود مياه سائلة على سطح المريخ في الماضي، وقد لا تزال موجودة تحت الأرض.", en:"There is strong evidence that liquid water existed on Mars' surface in the past, and may still exist underground."},{ar:"يشهد المريخ أكبر العواصف الترابية في النظام الشمسي، والتي يمكن أن تغطي الكوكب بأكمله أحيانًا.", en:"Mars experiences the largest dust storms in the Solar System, which can sometimes cover the entire planet."}] },
         { id: 5, name: { ar: "المشتري", en: "Jupiter" }, radius: 2.5, distance: 35, speed: 0.00125, tilt: 3.1, rotation: 0.1, texture: "jupiter.jpg", info: { ar: "القطر: 139,820 كم\nالكتلة: 1.898 × 10²⁷ كجم\nالدورة المدارية: 11.86 سنة\nحرارة قمة السحب: -145°م\nعملاق غازي", en: "Diameter: 139,820 km\nMass: 1.898 × 10²⁷ kg\nOrbit: 11.86 years\nCloud Top Temp: -145°C\nGas giant" }, fact: { ar: "المشتري هو أكبر كوكب ويتميز بالبقعة الحمراء العظيمة، وهي عاصفة عملاقة مستمرة منذ قرون.", en: "Jupiter is the largest planet and features the Great Red Spot, a giant storm raging for centuries."
[source: 355] }, extraFacts: [{ar:"يمتلك المشتري أقوى مجال مغناطيسي بين الكواكب، أقوى بحوالي 20,000 مرة من مجال الأرض.", en:"Jupiter has the strongest magnetic field of any planet, about 20,000 times stronger than Earth's."},{ar:"يدور المشتري أسرع من أي كوكب آخر، مكملاً دورة واحدة في أقل من 10 ساعات بقليل.", en:"Jupiter rotates faster than any other planet, completing one rotation in just under 10 hours."},{ar:"للمشتري نظام حلقات خافت وأقمار عديدة، بما في ذلك الأقمار الغاليلية الأربعة الكبيرة: آيو، أوروبا، جانيميد، وكاليستو.", en:"Jupiter has a faint ring system and numerous moons, including the four large Galilean moons: Io, Europa, Ganymede, and Callisto."}] },
         { id: 6, name: { ar: "زحل", en: "Saturn" }, radius: 2, distance: 45, speed: 0.0009375, tilt: 26.7, rotation: 0.09, texture: "saturn.jpg", info: { ar: "القطر: 116,460 كم\nالكتلة: 5.68 × 10²⁶ كجم\nالدورة المدارية: 29.46 سنة\nحرارة قمة السحب: -184°م\nعملاق غازي", en: "Diameter: 116,460 km\nMass: 5.68 × 10²⁶ kg\nOrbit: 29.46 years\nCloud Top Temp: -184°C\nGas giant" }, fact: { ar: "يشتهر زحل بنظام حلقاته المذهل، المكون في الغالب من جزيئات الجليد وحطام الصخور.", en: "Saturn is famous for its stunning ring system, made mostly of ice particles and rock debris."
[source: 356] }, extraFacts: [{ar:"زحل هو أقل الكواكب كثافة؛ كثافته أقل من الماء، مما يعني أنه سيطفو في حوض استحمام كبير بما فيه الكفاية!", en:"Saturn is the least dense planet; it's less dense than water, meaning it would float in a large enough bathtub!"},{ar:"أكبر أقمار زحل، تيتان، هو القمر الوحيد في النظام الشمسي الذي يمتلك غلافًا جويًا كثيفًا وبحيرات سائلة (من الميثان/الإيثان) على سطحه.", en:"Saturn's largest moon, Titan, is the only moon in the Solar System with a thick atmosphere and liquid lakes (of methane/ethane) on its surface."},{ar:"توجد عاصفة كبيرة ومستمرة سداسية الشكل عند القطب الشمالي لزحل.", en:"A large, persistent hexagonal-shaped storm exists at Saturn's north pole."}]
[source: 357] },
         { id: 7, name: { ar: "أورانوس", en: "Uranus" }, radius: 1.5, distance: 55, speed: 0.0005, tilt: 97.8, rotation: 0.06, texture: "uranus.jpg", info: { ar: "القطر: 50,724 كم\nالكتلة: 8.68 × 10²⁵ كجم\nالدورة المدارية: 84 سنة\nحرارة قمة السحب: -224°م\nعملاق جليدي", en: "Diameter: 50,724 km\nMass: 8.68 × 10²⁵ kg\nOrbit: 84 years\nCloud Top Temp: -224°C\nIce giant" }, fact: { ar: "يدور أورانوس على جانبه بميل محوري يبلغ حوالي 98 درجة، مما يجعله فريدًا بين الكواكب.", en: "Uranus rotates on its side with an axial tilt of nearly 98 degrees, making it unique among planets."
[source: 358] }, extraFacts: [{ar:"أورانوس هو أبرد كوكب في النظام الشمسي، على الرغم من أنه ليس الأبعد عن الشمس.", en:"Uranus is the coldest planet in the Solar System, despite not being the farthest from the Sun."},{ar:"يُعتقد أن ميله الشديد ناتج عن اصطدام هائل بجسم بحجم الأرض في وقت مبكر من تاريخ النظام الشمسي.", en:"Its extreme tilt is thought to be the result of a massive collision with an Earth-sized object early in the Solar System's history."},{ar:"مثل زحل، يمتلك أورانوس نظام حلقات، على الرغم من أنه أغمق وأخفت بكثير.", en:"Like Saturn, Uranus possesses a ring system, although it is much darker and fainter."}]
[source: 359] },
         { id: 8, name: { ar: "نبتون", en: "Neptune" }, radius: 1.5, distance: 65, speed: 0.000375, tilt: 28.3, rotation: 0.07, texture: "neptune.jpg", info: { ar: "القطر: 49,244 كم\nالكتلة: 1.02 × 10²⁶ كجم\nالدورة المدارية: 164.8 سنة\nحرارة قمة السحب: -201°م\nعملاق جليدي", en: "Diameter: 49,244 km\nMass: 1.02 × 10²⁶ kg\nOrbit: 164.8 years\nCloud Top Temp: -201°C\nIce giant" }, fact: { ar: "نبتون هو أبعد كوكب عن الشمس، معروف بلونه الأزرق العميق وأسرع رياح في النظام الشمسي.", en: "Neptune is the farthest planet from the Sun, known for its deep blue color and the fastest winds in the Solar System."
[source: 360] }, extraFacts: [{ar:"تم اكتشاف نبتون رياضيًا قبل رصده مباشرة، بناءً على الاضطرابات في مدار أورانوس.", en:"Neptune was discovered mathematically before being directly observed, based on perturbations in Uranus's orbit."},{ar:"يمكن أن تصل سرعة الرياح على نبتون إلى أكثر من 2000 كيلومتر في الساعة (1200 ميل في الساعة).", en:"Winds on Neptune can reach speeds of over 2,000 kilometers per hour (1,200 mph)."},{ar:"أكبر أقمار نبتون، ترايتون، يدور حول الكوكب في اتجاه تراجعي (عكس دوران نبتون) ومن المحتمل أنه جسم تم التقاطه من حزام كايبر.", en:"Neptune's largest moon, Triton, orbits the planet in a retrograde direction (opposite to Neptune's rotation) and is likely a captured Kuiper Belt Object."}]
[source: 361] }
       ];
[source: 362] // --- THREE.js Setup ---
      const clock = new THREE.Clock();
[source: 363] // Clock for delta time
      const scene = new THREE.Scene();
[source: 364] const camera = new THREE.PerspectiveCamera(75,window.innerWidth / window.innerHeight, 0.1, 2000);
      camera.position.set(0, 50, 100);
[source: 365] // Initial camera position
      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);
[source: 366] const controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.maxDistance = 400; // Max zoom out
      controls.minDistance = 10;
[source: 367] // Min zoom in
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;
[source: 368] // Variables to manage camera focus and following
      let focusedPlanetIndex = -1;
[source: 369] let isFollowingPlanet = false;
      let followAnimationId = null; // To cancel animation if needed

      // --- Time Control Variables ---
      let isPaused = false;
[source: 370] let timeMultiplier = 1.0; // Start at normal speed
      const maxTimeMultiplier = 16.0;
[source: 371] // Max speed limit
      const minTimeMultiplier = 0.125;
[source: 372] // Min speed limit (1/8x)


      // Stop following when user interacts with controls
      controls.addEventListener("start", () => {
        isFollowingPlanet = false;
        focusedPlanetIndex = -1;
        if (followAnimationId) cancelAnimationFrame(followAnimationId); // Stop any ongoing focus animation
      });
[source: 373] // --- Lighting ---
      const sunLight = new THREE.PointLight(0xffffff, 1.5, 1500);
[source: 374] // Brighter point light from the Sun
      scene.add(sunLight);
      const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
[source: 375] // Soft ambient light
      scene.add(ambientLight);
      const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 0.3);
[source: 376] // Gentle overhead light
      hemiLight.position.set(0, 100, 0);
      scene.add(hemiLight);
[source: 377] // --- Textures & Stars ---
      const loader = new THREE.TextureLoader();
[source: 378] const starGeometry = new THREE.BufferGeometry();
      const starCount = 7000; // Increased star count
      const positions = new Float32Array(starCount * 3);
[source: 379] for (let i = 0; i < starCount; i++) {
        positions[i * 3] = (Math.random() - 0.5) * 2500;
[source: 380] // Wider star field
        positions[i * 3 + 1] = (Math.random() - 0.5) * 2500;
[source: 381] positions[i * 3 + 2] = (Math.random() - 0.5) * 2500;
[source: 382] }
      starGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
      const starMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.15 });
[source: 383] const stars = new THREE.Points(starGeometry, starMaterial);
      scene.add(stars);


      // --- Planets, Orbits, Rings, Asteroids, Comet, Dust ---
      const planetMeshes = [];
[source: 384] // Store meshes and data together
      let totalElapsedTime = 0;
[source: 385] // Accumulate time for comet orbit independent of pause/speed

      planetsData.forEach((planet) => {
        const geometry = new THREE.SphereGeometry(planet.radius, 64, 64); // Higher detail spheres
        const material = new THREE.MeshStandardMaterial({
          color: 0xffffff, // Base color, texture will override
          emissive: planet.id === 0 ? 0xffff00 : 0x000000, // Sun emits light
          emissiveIntensity: planet.id === 0 ? 1.8
[source: 386] : 0, // Sun emission strength
        });

        loader.load(
          `textures/${planet.texture}`,
          (texture) => {
            material.map = texture;
            if (planet.id === 0) { // Special handling for Sun texture as emissive
              material.emissiveMap = texture;
              material.emissive = new THREE.Color(0xffffaa); // Warm emission color
[source: 387] material.emissiveIntensity = 1.2;
            }
            material.needsUpdate = true;
          },
          undefined,
          (err) => console.error(`Error loading texture: ${planet.texture}`, err)
[source: 388] );

        const mesh = new THREE.Mesh(geometry, material);
        mesh.position.x = planet.distance;
[source: 389] mesh.rotation.x = (planet.tilt * Math.PI) / 180; // Apply axial tilt
        mesh.userData.id = planet.id;
[source: 390] // Store planet ID for raycasting/lookup
        scene.add(mesh);
[source: 391] // Orbit lines (except for Sun)
        if (planet.distance > 0) {
          const points = [];
[source: 392] const segments = 128; // Smoother orbit lines
          for (let i = 0; i <= segments; i++) {
            const theta = (i / segments) * Math.PI * 2;
[source: 393] points.push(new THREE.Vector3(Math.cos(theta) * planet.distance, 0, Math.sin(theta) * planet.distance));
          }
          const orbitGeometry = new THREE.BufferGeometry().setFromPoints(points);
[source: 394] // Color-code orbits for visual distinction
          const colorMap = { 1: 0xaaaaaa, 2: 0xffcc99, 3: 0x3399ff, 4: 0xff3333, 5: 0xffaa33, 6: 0xffdd77, 7: 0x66ccff, 8: 0x3366cc, };
[source: 395] const orbitMaterial = new THREE.LineBasicMaterial({
            color: colorMap[planet.id] || 0xffffff, // Default white if no color defined
            transparent: true,
            opacity: 0.4, // Subtle orbits
          });
[source: 396] const orbit = new THREE.Line(orbitGeometry, orbitMaterial);
          scene.add(orbit);
        }

        // Saturn's Rings
        if (planet.id === 6) {
           const ringTexture = loader.load("textures/saturn_ring.png");
[source: 397] const innerRadius = planet.radius * 1.2;
           const outerRadius = planet.radius * 2.2;
           const ringGeometry = new THREE.RingGeometry(innerRadius, outerRadius, 64);
[source: 398] // Fix ring texture mapping
           var pos = ringGeometry.attributes.position;
[source: 399] var v3 = new THREE.Vector3();
           for (let i = 0; i < pos.count; i++){
             v3.fromBufferAttribute(pos, i);
[source: 400] ringGeometry.attributes.uv.setXY(i, v3.length() < innerRadius + 0.1 ? 0 : 1, 1);
[source: 401] }
           const ringMaterial = new THREE.MeshBasicMaterial({
             map: ringTexture,
             color: 0xffffff,
             side: THREE.DoubleSide,
             transparent: true,
             opacity: 0.8
           });
[source: 402] const rings = new THREE.Mesh(ringGeometry, ringMaterial);
           rings.rotation.x = Math.PI / 2;
[source: 403] // Orient rings correctly
           mesh.add(rings);
[source: 404] // Add rings as a child of Saturn
        }

        // Jupiter's Great Red Spot (simplified)
        if (planet.id === 5) {
          const spotGeometry = new THREE.SphereGeometry(planet.radius * 0.2, 16, 16);
[source: 405] // Small sphere for spot
          const spotMaterial = new THREE.MeshBasicMaterial({ color: 0xbb5533, transparent: true, opacity: 0.8 });
[source: 406] const redSpot = new THREE.Mesh(spotGeometry, spotMaterial);
          redSpot.position.set(0, planet.radius * 0.5, planet.radius * 0.85);
[source: 407] // Position on Jupiter's surface
          mesh.add(redSpot);
[source: 408] // Add spot as child
        }


        planetMeshes.push({ mesh, planetData: planet, angle: Math.random() * Math.PI * 2 });
[source: 409] // Store mesh, data, and current angle
      });
[source: 410] // Asteroid Belt
      const asteroidGeometry = new THREE.BufferGeometry();
      const asteroidCount = 1500;
[source: 411] // More asteroids
      const asteroidPos = new Float32Array(asteroidCount * 3);
[source: 412] const marsOrbit = planetsData.find(p => p.id === 4).distance;
      const jupiterOrbit = planetsData.find(p => p.id === 5).distance;
[source: 413] const beltInnerRadius = marsOrbit + 3; // Position belt between Mars and Jupiter
      const beltOuterRadius = jupiterOrbit - 5;
[source: 414] const beltWidth = beltOuterRadius - beltInnerRadius;
      for (let i = 0; i < asteroidCount; i++) {
        const angle = Math.random() * Math.PI * 2;
[source: 415] const radius = beltInnerRadius + Math.random() * beltWidth; // Random radius within the belt
        asteroidPos[i * 3] = Math.cos(angle) * radius;
[source: 416] asteroidPos[i * 3 + 1] = (Math.random() - 0.5) * 1.0;
[source: 417] // Slight vertical variation
        asteroidPos[i * 3 + 2] = Math.sin(angle) * radius;
[source: 418] }
      asteroidGeometry.setAttribute('position', new THREE.BufferAttribute(asteroidPos, 3));
      const asteroidMaterial = new THREE.PointsMaterial({ color: 0xaaaaaa, size: 0.08 });
[source: 419] const asteroids = new THREE.Points(asteroidGeometry, asteroidMaterial);
      scene.add(asteroids);

      // Comet
      const cometGeometry = new THREE.SphereGeometry(0.2, 16, 16);
[source: 420] // Small comet head
      const cometMaterial = new THREE.MeshBasicMaterial({ color: 0xaaddff });
[source: 421] // Icy blue
      const comet = new THREE.Mesh(cometGeometry, cometMaterial);
      scene.add(comet);
[source: 422] // Comet Tail (simple line)
      const tailPoints = [new THREE.Vector3(0, 0, 0), new THREE.Vector3(0, 0, -2)];
[source: 423] // Points away from the sun (updated in animate)
      const tailGeometry = new THREE.BufferGeometry().setFromPoints(tailPoints);
[source: 424] const tailMaterial = new THREE.LineBasicMaterial({ color: 0xaaddff, transparent: true, opacity: 0.6, linewidth: 2 });
      const tail = new THREE.Line(tailGeometry, tailMaterial);
[source: 425] comet.add(tail); // Add tail as child of comet

      // Background Dust (subtle)
      const dustGeometry = new THREE.BufferGeometry();
[source: 426] const dustCount = 1000;
      const dustPos = new Float32Array(dustCount * 3);
[source: 427] for (let i = 0; i < dustCount; i++) {
         dustPos[i * 3] = (Math.random() - 0.5) * 200;
[source: 428] // Spread dust around
         dustPos[i * 3 + 1] = (Math.random() - 0.5) * 200;
[source: 429] dustPos[i * 3 + 2] = (Math.random() - 0.5) * 200;
[source: 430] }
      dustGeometry.setAttribute('position', new THREE.BufferAttribute(dustPos, 3));
[source: 431] const dustMaterial = new THREE.PointsMaterial({ color: 0x777777, size: 0.05, transparent: true, opacity: 0.4, });
      const dust = new THREE.Points(dustGeometry, dustMaterial);
[source: 432] scene.add(dust);

      // --- Constellation Placeholder Removed ---


      // --- DOM Elements ---
      const infoPanel = document.getElementById("infoPanel");
[source: 433] const planetNameEl = document.getElementById("planetName");
      const planetInfoEl = document.getElementById("planetInfo");
      const planetFactEl = document.getElementById("planetFact");
      const closeBtn = document.getElementById("closeBtn");
      const planetsMenu = document.getElementById("planetsMenu");
[source: 434] const planetsDropdown = document.getElementById("planetsDropdown");
      const langToggleBtn = document.getElementById("langToggleBtn");
      const bodyEl = document.body;
      const readMoreBtn = document.getElementById("readMoreBtn");
[source: 435] // New Button
      const extraFactsContainer = document.getElementById("extraFactsContainer");
[source: 436] // New Container
      // Time Control Elements
      const playPauseBtn = document.getElementById('playPauseBtn');
[source: 437] const speedUpBtn = document.getElementById('speedUpBtn');
      const slowDownBtn = document.getElementById('slowDownBtn');
      const speedDisplay = document.getElementById('speedDisplay');
[source: 438] // Constellation Toggle Element Removed


      // --- Raycasting ---
      const raycaster = new THREE.Raycaster();
[source: 439] const mouse = new THREE.Vector2();

      // --- Event Listeners ---
      window.addEventListener("click", (event) => {
        // Prevent clicks on menu/infopanel from triggering raycast
        if (event.target.closest('#menuBar') || event.target.closest('#infoPanel')) {
             return;
        }

        // Calculate mouse position in normalized device coordinates
        mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
[source: 440] raycaster.setFromCamera(mouse, camera); // Update the picking ray

        // Calculate objects intersecting the picking ray
        const intersects = raycaster.intersectObjects(planetMeshes.map((p) => p.mesh));

        if (intersects.length > 0) {
          const clickedPlanetMesh = intersects[0].object;
          const planetId = clickedPlanetMesh.userData.id; // Get the ID stored earlier


[source: 441] // Check if a valid ID was retrieved
          if (planetId !== undefined) {
              // Call the same function used by the dropdown menu
              focusOnPlanet(planetId);
[source: 442] }
        } else {
          // Optional: Clicking empty space could potentially stop following
          // if (isFollowingPlanet) {
          //    isFollowingPlanet = false;
          //    focusedPlanetIndex = -1;
[source: 443] // }
        }
      });
[source: 444] closeBtn.addEventListener("click", () => {
        infoPanel.style.display = "none";
        isFollowingPlanet = false; // Stop following when panel is closed
        focusedPlanetIndex = -1;
        currentlyDisplayedPlanetId = null; // Reset tracked planet
      });
[source: 445] planetsMenu.addEventListener("click", (e) => {
        e.stopPropagation(); // Prevent click from closing dropdown immediately
        planetsDropdown.classList.toggle("show");
      });
[source: 446] // Close dropdown if clicking outside
      document.addEventListener("click", (e) => {
          if (!planetsMenu.contains(e.target)) {
              planetsDropdown.classList.remove('show');
          }
      });
[source: 447] langToggleBtn.addEventListener("click", () => {
          currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
          updateLanguageUI();
      });
[source: 448] // Event Listener for Read More Button
       readMoreBtn.addEventListener("click", () => {
           const planetId = parseInt(readMoreBtn.getAttribute('data-planet-id'));
           if (isNaN(planetId)) return; // Exit if no valid ID

           const planetData = planetsData.find(p => p.id === planetId);
           if (planetData && planetData.extraFacts) {
               populateExtraFacts(planetData.extraFacts);
               extraFactsContainer.style.display = 'block';
[source: 449] readMoreBtn.style.display = 'none'; // Hide button after clicking
           }
       });
[source: 450] // --- Time Control Event Listeners ---
       playPauseBtn.addEventListener('click', () => {
           isPaused = !isPaused;
           playPauseBtn.textContent = isPaused ? uiText.playBtn[currentLanguage] : uiText.pauseBtn[currentLanguage];
           // If unpausing, restart the clock to avoid a large jump in delta time
           if (!isPaused) {
                clock.getDelta();
[source: 451] // Consume the large delta from the paused time
           }
       });
[source: 452] speedUpBtn.addEventListener('click', () => {
           if (timeMultiplier < maxTimeMultiplier) {
               timeMultiplier *= 2;
               updateSpeedDisplay();
           }
       });
[source: 453] slowDownBtn.addEventListener('click', () => {
            if (timeMultiplier > minTimeMultiplier) {
                timeMultiplier /= 2;
                updateSpeedDisplay();
            }
       });
[source: 454] // --- Constellation Toggle Event Listener Removed ---


      // --- Functions ---

       function populateExtraFacts(facts) {
            extraFactsContainer.innerHTML = '';
[source: 455] // Clear previous facts
            facts.forEach(fact => {
                const p = document.createElement('p');
                p.textContent = fact[currentLanguage];
                extraFactsContainer.appendChild(p);
            });
[source: 456] }

       function updateSpeedDisplay() {
            speedDisplay.textContent = `${timeMultiplier}x`;
[source: 457] }

       function displayPlanetInfo(planetData) {
         planetNameEl.textContent = planetData.name[currentLanguage];
[source: 458] planetInfoEl.innerHTML = planetData.info[currentLanguage].replace(/\n/g, "<br>"); // Use innerHTML to render line breaks
         planetFactEl.textContent = planetData.fact[currentLanguage];
[source: 459] currentlyDisplayedPlanetId = planetData.id; // Track current planet

         // Reset and setup Read More section
         extraFactsContainer.style.display = 'none';
[source: 460] // Hide extra facts initially
         extraFactsContainer.innerHTML = '';
[source: 461] // Clear old facts
         if (planetData.extraFacts && planetData.extraFacts.length > 0) {
             readMoreBtn.style.display = 'block';
[source: 462] // Show button if facts exist
             readMoreBtn.setAttribute('data-planet-id', planetData.id);
[source: 463] // Set ID for button listener
             readMoreBtn.textContent = uiText.readMore[currentLanguage];
[source: 464] // Set button text
         } else {
             readMoreBtn.style.display = 'none';
[source: 465] // Hide button if no extra facts
         }

         infoPanel.style.display = "block";
[source: 466] infoPanel.scrollTop = 0; // Scroll to top when displaying new info
      }


      function updateLanguageUI() {
          bodyEl.dir = currentLanguage === 'ar' ? 'rtl' : 'ltr';
[source: 467] planetsMenu.firstChild.textContent = uiText.planetsMenu[currentLanguage].trim(); // Update menu title text
          langToggleBtn.textContent = uiText.langToggle[currentLanguage];
[source: 468] readMoreBtn.textContent = uiText.readMore[currentLanguage]; // Update button text
          playPauseBtn.textContent = isPaused ? uiText.playBtn[currentLanguage] : uiText.pauseBtn[currentLanguage]; // Update play/pause button text
[source: 469] slowDownBtn.textContent = "⏪"; // Ensure icons stay
          speedUpBtn.textContent = "⏩"; // Ensure icons stay
          // Constellation button update removed

          // Update dropdown items
          planetsDropdown.innerHTML = '';
[source: 470] // Clear existing items
          planetsData.forEach((planet) => {
              const item = document.createElement("a");
              item.href = "#";
              item.classList.add("dropdown-item");
              item.setAttribute("data-planet-id", planet.id);
              item.textContent = planet.name[currentLanguage];
              item.addEventListener("click", (e) => {
[source: 471] e.preventDefault(); // Prevent page jump
                  e.stopPropagation(); // Prevent body click listener
                  const planetId = parseInt(item.getAttribute("data-planet-id"));
                  focusOnPlanet(planetId);
                  planetsDropdown.classList.remove("show"); // Close dropdown
[source: 472] });
              planetsDropdown.appendChild(item);
          });
[source: 473] // If info panel is open, update its content
           if (currentlyDisplayedPlanetId !== null) {
               const currentPlanetData = planetsData.find(p => p.id === currentlyDisplayedPlanetId);
[source: 474] if (currentPlanetData) {
                   // Re-display main info in new language
                   planetNameEl.textContent = currentPlanetData.name[currentLanguage];
[source: 475] planetInfoEl.innerHTML = currentPlanetData.info[currentLanguage].replace(/\n/g, "<br>");
                   planetFactEl.textContent = currentPlanetData.fact[currentLanguage];
                   // Update Read More button text (already done above)
                   readMoreBtn.setAttribute('data-planet-id', currentPlanetData.id);
[source: 476] // Ensure ID is set

                   // If extra facts are currently visible, update their language
                   if (extraFactsContainer.style.display === 'block' && currentPlanetData.extraFacts) {
                        populateExtraFacts(currentPlanetData.extraFacts);
[source: 477] }
                   // Ensure Read More button visibility is correct for the current state
                   if (extraFactsContainer.style.display !== 'block' && currentPlanetData.extraFacts && currentPlanetData.extraFacts.length > 0) {
                        readMoreBtn.style.display = 'block';
[source: 478] } else {
                        readMoreBtn.style.display = 'none';
[source: 479] }
               }
           }

         // Adjust text alignment based on language
         infoPanel.style.textAlign = currentLanguage === 'ar' ? 'right' : 'left';
[source: 480] }


      function focusOnPlanet(planetId) {
          const planetIndex = planetsData.findIndex(p => p.id === planetId);
[source: 481] if (planetIndex === -1) return; // Planet not found

          const targetPlanet = planetMeshes[planetIndex];
[source: 482] const targetData = targetPlanet.planetData;

          if (followAnimationId) cancelAnimationFrame(followAnimationId); // Cancel previous animation

          focusedPlanetIndex = planetIndex;
[source: 483] // Set the index of the planet to follow
          infoPanel.style.display = 'none';
[source: 484] // Hide panel during transition
          currentlyDisplayedPlanetId = null;
[source: 485] // Reset tracked planet during transition


          // Camera animation setup
          const startPosition = camera.position.clone();
[source: 486] const startTarget = controls.target.clone(); // Current look-at point
          const endTarget = targetPlanet.mesh.position.clone();
[source: 487] // Look at the planet's center

          // Calculate desired camera position (offset from the planet)
          const offsetDistance = targetData.radius * (targetData.id === 0 ? 5 : 8);
[source: 488] // Closer for Sun, further for planets
          const direction = new THREE.Vector3(0, 0.2, 1);
[source: 489] // Base direction (slightly above, behind)
          direction.applyQuaternion(targetPlanet.mesh.quaternion);
[source: 490] // Rotate direction based on planet tilt? (might not be needed if tilt is visual only)
          direction.normalize();
[source: 491] const endPosition = endTarget.clone().add(direction.multiplyScalar(offsetDistance));

          const duration = 1500; // Animation duration in ms
          const startTime = Date.now();
[source: 492] function animateCameraFocus() {
              const elapsed = Date.now() - startTime;
[source: 493] const progress = Math.min(elapsed / duration, 1); // Progress from 0 to 1
              const easeProgress = 0.5 * (1 - Math.cos(Math.PI * progress));
[source: 494] // Smooth ease-in-out

              // Interpolate camera position and target
              camera.position.lerpVectors(startPosition, endPosition, easeProgress);
[source: 495] controls.target.lerpVectors(startTarget, endTarget, easeProgress);
              controls.update(); // Necessary for OrbitControls damping/updates

              if (progress < 1) {
                  followAnimationId = requestAnimationFrame(animateCameraFocus);
[source: 496] // Continue animation
              } else {
                  // Animation finished
                  followAnimationId = null;
[source: 497] isFollowingPlanet = true; // Start following the planet
                  controls.target.copy(endTarget);
[source: 498] // Ensure target is exact
                  camera.position.copy(endPosition);
[source: 499] // Ensure position is exact
                  controls.update();
[source: 500] displayPlanetInfo(targetData); // Show info AFTER arriving
              }
          }
          animateCameraFocus();
[source: 501] // Start the animation
      }


      // --- Animation Loop ---
      function animate() {
        requestAnimationFrame(animate);
[source: 502] // Loop

        // Get time elapsed since last frame (delta time)
        // Use clock.getDelta() only if not paused to get actual elapsed time for animation
        const delta = !isPaused ? clock.getDelta() : 0;
[source: 503] // Accumulate total time for things that shouldn't speed up/slow down (like comet)
        // *** NOTE: totalElapsedTime is still accumulated even when paused. If comet should pause, this needs adjustment. ***
        totalElapsedTime += clock.getDelta();
[source: 504] // Always add actual elapsed time

        // Apply time multiplier to the delta used for physics/animation updates
        const scaledDelta = delta * timeMultiplier;
[source: 505] // Only update planet positions and rotations if not paused
        if (!isPaused && scaledDelta > 0) {
             // Animate Planets
             planetMeshes.forEach((p, index) => {
               const { mesh, planetData } = p;

               // Self-rotation - scaled by time multiplier
               mesh.rotation.y += planetData.rotation * 5 * scaledDelta; // Use scaledDelta
[source: 506] // Orbital movement (if not the Sun) - scaled by time multiplier
               if (planetData.distance > 0) {
                 // Calculate angle change based on speed and scaled delta time
                 const angleChange = planetData.speed * 100 * scaledDelta; // Use scaledDelta, adjust base speed factor if needed
[source: 507] p.angle += angleChange;
                 mesh.position.x = Math.cos(p.angle) * planetData.distance;
                 mesh.position.z = Math.sin(p.angle) * planetData.distance;
               }
[source: 508] });

             // *** MOVED COMET UPDATE LOGIC HERE ***
             // Animate Comet (Elliptical Orbit) - Use totalElapsedTime for consistent speed regardless of pause/multiplier
             const cometTimeFactor = totalElapsedTime * 0.2;
[source: 509] // Adjust base speed if needed
             const cometSemiMajor = 80;
[source: 510] // Ellipse dimensions
             const cometSemiMinor = 50;
[source: 511] comet.position.x = Math.cos(cometTimeFactor) * cometSemiMajor;
             comet.position.z = Math.sin(cometTimeFactor) * cometSemiMinor;
             comet.position.y = Math.sin(cometTimeFactor * 0.7) * 15;
[source: 512] // Add some vertical motion
             // Point comet tail away from the sun (origin)
             const dirToSun = comet.position.clone().normalize().negate();
[source: 513] comet.lookAt(comet.position.clone().add(dirToSun));
        }

        // Update camera following logic (needs to run even if paused to maintain view if target moves slightly before pause)
        if (isFollowingPlanet && focusedPlanetIndex !== -1) {
           const targetMesh = planetMeshes[focusedPlanetIndex].mesh;
[source: 514] const currentTargetPosition = targetMesh.position.clone();
           controls.target.copy(currentTargetPosition); // Keep controls looking at the planet

           // Calculate desired camera offset position smoothly
           const targetData = planetMeshes[focusedPlanetIndex].planetData;
[source: 515] const offsetDistance = targetData.radius * (targetData.id === 0 ? 5 : 8);
           const direction = new THREE.Vector3(0, 0.2, 1);
           direction.applyQuaternion(targetMesh.quaternion);
[source: 516] direction.normalize();
           const desiredPosition = currentTargetPosition.clone().add(direction.multiplyScalar(offsetDistance));

           // Smoothly move camera towards the desired offset position
           camera.position.lerp(desiredPosition, 0.05);
[source: 517] }


        controls.update(); // Update OrbitControls (handles damping, needed always)
        renderer.render(scene, camera);
[source: 518] // Render the scene
      }

      // --- Initial Setup ---
      updateLanguageUI();
[source: 519] // Populate UI elements with initial language
      updateSpeedDisplay();
[source: 520] // Set initial speed display
      animate();
[source: 521] // Start the animation loop

      // Initial Zoom Effect JS block removed

      // --- Resize Listener ---
      window.addEventListener("resize", () => {
        // Update camera aspect ratio and projection matrix
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        // Update renderer size
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
[source: 522] </script>
  </body>
</html>
